<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Daily Workout â€“ {{ male_name }} & {{ female_name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- PWA / Icons -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest-' ~ role ~ '.json') }}">
    <link rel="icon" href="{{ url_for('static', filename='icons/icon-192.png') }}">

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #0f172a;
            color: #e5e7eb;
        }

        .app {
            max-width: 960px;
            margin: 0 auto;
            padding: 16px;
        }

        header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 16px;
        }

        .date-block {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .date-main {
            font-size: 1.4rem;
            font-weight: 600;
        }

        .date-sub {
            font-size: 0.9rem;
            color: #9ca3af;
        }

        .role-block {
            text-align: right;
        }

        .role-label {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .role-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.85rem;
            background: rgba(148, 163, 184, 0.16);
            color: #e5e7eb;
        }

        .role-chip span.icon {
            font-size: 1.1rem;
        }

        .card {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 12px;
            padding: 12px 14px;
            margin-bottom: 12px;
            border: 1px solid rgba(55, 65, 81, 0.7);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 6px;
        }

        .card-title {
            font-size: 0.95rem;
            font-weight: 600;
        }

        .card-sub {
            font-size: 0.8rem;
            color: #9ca3af;
        }

        /* Totals-Grid */
        .totals-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            margin-top: 6px;
        }

        @media (min-width: 640px) {
            .totals-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        .totals-item {
            font-size: 0.85rem;
            color: #d1d5db;
            padding: 6px 8px;
            border-radius: 8px;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(55, 65, 81, 0.7);
        }

        .totals-title {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .male-totals {
            border-left: 3px solid #60a5fa;
        }

        .male-totals .totals-title {
            color: #60a5fa;
        }

        .female-totals {
            border-left: 3px solid #f9a8d4;
        }

        .female-totals .totals-title {
            color: #f9a8d4;
        }

        .exercises {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 10px;
        }

        .exercise-card {
            background: rgba(15, 23, 42, 0.95);
            border-radius: 10px;
            padding: 10px;
            border: 1px solid rgba(55, 65, 81, 0.7);
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .exercise-name {
            font-size: 0.95rem;
            font-weight: 600;
        }

        .exercise-reps {
            font-size: 0.85rem;
            color: #9ca3af;
        }

        .exercise-action-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-top: 4px;
            padding: 6px 8px;
            font-size: 0.85rem;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            background: rgba(22, 163, 74, 0.12);
            color: #bbf7d0;
        }

        .exercise-action-btn.done {
            background: rgba(22, 163, 74, 0.35);
            color: #ecfdf5;
        }

        .exercise-other-status {
            font-size: 0.78rem;
            color: #9ca3af;
            margin-top: 2px;
        }

        .status-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .status-btn {
            flex: 1 1 120px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px;
            font-size: 0.85rem;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            white-space: nowrap;
        }

        .status-btn.skip {
            background: rgba(234, 179, 8, 0.12);
            color: #facc15;
        }

        .status-btn.injured {
            background: rgba(220, 38, 38, 0.16);
            color: #fecaca;
        }

        .status-btn.cant {
            background: rgba(59, 130, 246, 0.18);
            color: #bfdbfe;
        }

        .status-summary {
            margin-top: 8px;
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .message-bar {
            margin-top: 10px;
            font-size: 0.85rem;
            padding: 8px 10px;
            border-radius: 8px;
        }

        .message-info {
            background: rgba(59, 130, 246, 0.12);
            border: 1px solid rgba(59, 130, 246, 0.4);
            color: #bfdbfe;
        }

        .message-error {
            background: rgba(220, 38, 38, 0.14);
            border: 1px solid rgba(239, 68, 68, 0.6);
            color: #fecaca;
        }

        .message-success {
            background: rgba(22, 163, 74, 0.12);
            border: 1px solid rgba(34, 197, 94, 0.5);
            color: #bbf7d0;
        }

        .phrase-card {
            font-size: 0.9rem;
            padding: 10px 12px;
            border-radius: 10px;
            background: rgba(15, 23, 42, 0.95);
            border: 1px dashed rgba(148, 163, 184, 0.7);
            margin-top: 10px;
        }

        .badge {
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 0.7rem;
            background: rgba(148, 163, 184, 0.2);
            color: #e5e7eb;
        }

        .cheater-badge {
            background: rgba(248, 113, 113, 0.18);
            color: #fecaca;
        }
    </style>
</head>
<body data-role="{{ role }}" data-male-name="{{ male_name }}" data-female-name="{{ female_name }}">
<div class="app">

    <!-- HEADER + TOTALS + EXERCISES bleiben unverÃ¤ndert -->

    <!-- SCRIPT -->
<script>
(function () {

    var role = document.body.getAttribute('data-role');
    var maleName = document.body.getAttribute('data-male-name');
    var femaleName = document.body.getAttribute('data-female-name');

    var stateData = null;

    /* -------------------------------
       Neue Funktion fÃ¼r Toggle-Status
    --------------------------------*/
    function getMyStatus() {
        if (!stateData || !stateData.status) return {};
        return stateData.status[role] || {};
    }

    function xhrGet(url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status >= 200 && xhr.status < 300) {
                    try {
                        callback(null, JSON.parse(xhr.responseText));
                    } catch (e) {
                        callback(e);
                    }
                } else callback(new Error('HTTP ' + xhr.status));
            }
        };
        xhr.send();
    }

    function xhrPost(url, body, callback) {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', url, true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status >= 200 && xhr.status < 300) {
                    try {
                        callback(null, JSON.parse(xhr.responseText));
                    } catch (e) {
                        callback(e);
                    }
                } else callback(new Error('HTTP ' + xhr.status));
            }
        };
        xhr.send(JSON.stringify(body));
    }

    function sendAction(type, extra) {
        var body = { role: role, action: type };
        if (extra) Object.assign(body, extra);

        xhrPost('/api/action', body, function (err, data) {
            if (!err) stateData = data;
            updateUI();
        });
    }

    function bindEvents() {

        var btnCrunch = document.getElementById('btn-crunches');
        var btnPush = document.getElementById('btn-pushups');
        var btnSquat = document.getElementById('btn-squats');

        // -------------------------
        // ðŸ”¥ Toggle-Buttons
        // -------------------------

        if (btnCrunch) btnCrunch.onclick = function () {
            var s = getMyStatus();
            sendAction(s.crunches_done ? 'exercise_undo' : 'exercise', { exercise: 'crunches' });
        };

        if (btnPush) btnPush.onclick = function () {
            var s = getMyStatus();
            sendAction(s.pushups_done ? 'exercise_undo' : 'exercise', { exercise: 'pushups' });
        };

        if (btnSquat) btnSquat.onclick = function () {
            var s = getMyStatus();
            sendAction(s.squats_done ? 'exercise_undo' : 'exercise', { exercise: 'squats' });
        };
    }

    function loadState() {
        xhrGet('/api/state?role=' + encodeURIComponent(role), function (err, data) {
            if (!err) {
                stateData = data;
                updateUI();
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        bindEvents();
        loadState();
    });

})();
</script>

</div>
</body>
</html>
