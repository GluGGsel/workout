<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Workout</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <style>
    :root{
      --male-bg:#e9f2ff; --male-border:#6aa6ff; --male-accent:#2c6cff;
      --female-bg:#ffe9f4; --female-border:#ff86b7; --female-accent:#e33682;
      --ok:#16a34a; --muted:#666;
    }
    html,body{height:100%}
    body{
      font-family:Arial,Helvetica,sans-serif;
      padding:24px;
      background:#fafafa;
      color:#111;
      -webkit-text-size-adjust:100%;
    }
    h1{margin:0 0 6px;font-size:2rem;}
    .muted{color:var(--muted);font-size:1rem;margin:4px 0 16px}
    .counter-title{
      margin-top:4px;
      font-size:1.3rem;
      font-weight:700;
      color:#444;
    }
    .overall-box{
      margin:8px 0 18px;
      padding:12px;
      background:#fff;
      border-radius:10px;
      border:1px solid #ddd;
      font-size:0.95rem;
    }
    .overall-person{
      margin-top:6px;
      margin-bottom:4px;
      font-weight:600;
    }
    .overall-row{
      display:flex;
      justify-content:space-between;
      padding:3px 0;
    }
    .text-small{
      font-size:0.85rem;
      color:#666;
      margin-bottom:6px;
    }
    .date-line{
      font-size:1.8rem;
      font-weight:700;
      margin:4px 0 8px;
    }
    .container{display:flex;gap:20px;flex-wrap:wrap}
    .panel{
      border:2px solid #ddd;
      border-radius:12px;
      padding:18px;
      width:340px;
      background:white;
    }
    .panel.male{background:var(--male-bg);border-color:var(--male-border)}
    .panel.female{background:var(--female-bg);border-color:var(--female-border)}
    .panel h2{margin:0 0 10px;font-size:1.4rem}

    .exercise{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin:10px 0;
      padding:10px;
      border-radius:10px;
      background:white;
      cursor:pointer;
      user-select:none;
      border:1px solid #ddd;
    }
    .exercise.done{
      background:#f0fff0;
      border-color:#88cc88;
      color:#1a7f1a;
      font-weight:bold;
    }
    .exercise.injured{
      background:#fff5f5;
      border-color:#f97373;
      color:#b91c1c;
      font-weight:bold;
    }
    .exercise.injured strong{
      color:#b91c1c;
    }

    .skip-btn,
    .injured-btn,
    .cant-btn{
      padding:10px;
      border-radius:8px;
      margin:8px 0;
      cursor:pointer;
      font-size:0.95rem;
    }
    .skip-btn{
      border:1px dashed #bbb;
      background:#fff7f0;
    }
    .injured-btn{
      border:1px dashed #f97373;
      background:#fff0f0;
    }
    .cant-btn{
      border:1px solid #444;
      background:#ffecec;
      font-weight:bold;
    }

    .readonly{
      opacity:.6;pointer-events:none;
    }
    .hidden{display:none;}

    .status{margin:12px 0 16px;font-size:1.1rem;font-weight:600}
    .status .done{color:var(--ok)}
    .status .wait{color:#b45309}

    button{
      padding:12px 16px;
      border-radius:12px;
      border:1px solid #ccc;
      background:#fff;
      cursor:pointer;
      font-size:1rem;
      min-height:48px;
    }
    .disabled{opacity:.5;pointer-events:none}

    @media(max-width:768px){
      body{padding:18px;font-size:18px;line-height:1.35}
      h1{font-size:2rem}
      .date-line{font-size:2rem}
      .container{flex-direction:column;gap:16px}
      .panel{width:100%;max-width:none}
    }
  </style>
</head>
<body>
  <h1>Workout</h1>

  <div class="counter-title">Workout-Counter</div>
  <div id="overallBox" class="overall-box"></div>

  <div class="date-line">Heute: <span id="date">–</span></div>
  <div class="muted">Tag: <span id="day">1</span></div>
  <div id="overallStatus" class="status"></div>

  <div class="container">
    <div class="panel male" id="malePanel">
      <h2>Mann</h2>
      <div id="maleExercises"></div>
    </div>

    <div class="panel female" id="femalePanel">
      <h2>Frau</h2>
      <div id="femaleExercises"></div>
    </div>
  </div>

  <div style="margin-top:18px">
    <button id="nextDayBtn" class="disabled">Nächster Tag</button>
  </div>

  <script>
    const START_DATE = new Date('2025-11-12T00:00:00');
    const params = new URLSearchParams(window.location.search);
    const view = (params.get('view') || '').toLowerCase();
    const whoAmI = view === 'mann' ? 'male' : view === 'frau' ? 'female' : '';

    async function fetchState() {
      const res = await fetch("/api/state");
      return res.json();
    }

    const weekdays = ["So","Mo","Di","Mi","Do","Fr","Sa"];

    function formatDate(day){
      const d = new Date(START_DATE.getTime());
      d.setDate(d.getDate() + (day - 1));
      const dd = String(d.getDate()).padStart(2,'0');
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const yyyy = d.getFullYear();
      return `${weekdays[d.getDay()]}, ${dd}.${mm}.${yyyy}`;
    }

    // ================== SPRÜCHE ==================

    const nobody = [
      "Niemand fertig. Wenigstens sind die Ausreden gut trainiert.",
      "Status: 0% Training, 100% Aufschieben.",
      "Alle da, keiner fertig. Klassischer Team-Erfolg.",
      "Heute wird anscheinend nur die Couch belastet.",
      "Niemand fertig, aber alle mental überfordert.",
      "Der Schweinehund hat klar gewonnen.",
      "Mehr Aktivität im WLAN als in den Muskeln.",
      "Niemand fertig. Aber die Hoffnung stirbt… morgen.",
      "Trainingsstand: tief, Motivation: im Keller.",
      "Alle warten auf den perfekten Moment. Der war vor drei Stunden.",
      "Niemand fertig. Vielleicht war heute nur Aufwärmen für morgen.",
      "Noch kein Häkchen, aber viel Potenzial zum Schönreden.",
      "Niemand fertig. Das ist schon fast konsequent.",
      "Die Stoppuhr läuft, der Puls nicht.",
      "Niemand fertig. Aber Hauptsache, die Ausreden sind individuell.",
      "Hier wurde heute nur die Selbsttäuschung bewegt.",
      "Trainingslevel: Tutorial übersprungen.",
      "Niemand fertig, aber Kalorienverbrauch beim Jammern steigt.",
      "Niemand fertig. Vielleicht muss erst der Mond richtig stehen.",
      "Alle tun ihr Bestes, nichts zu tun.",
      "Die Motivation liegt offenbar noch im Bett.",
      "Niemand fertig. Immerhin bleibt der Boden sauber – keiner schwitzt drauf.",
      "Die Luft ist raus, bevor überhaupt Luft geholt wurde.",
      "Niemand fertig. Aber der Tag ist ja noch lang… theoretisch.",
      "Heute wurde nur der Weg zur Ausrede geübt.",
      "Niemand fertig. Dafür kennen jetzt alle die Knöpfe der App.",
      "Bis jetzt hat nur die Schwerkraft gearbeitet.",
      "Niemand fertig. Vielleicht ist heute einfach nur mentaler Sport angesagt.",
      "Noch kein Muskel gereizt, aber einige Ausreden perfektioniert.",
      "Niemand fertig. Der bequemste Personal Trainer der Welt: Prokrastination.",
      "So viele Möglichkeiten zu trainieren, so wenig Bereitschaft sie zu nutzen.",
      "Niemand fertig. Die Trainingskleidung fühlt sich vernachlässigt.",
      "Aktueller Status: Warmwerden mit Ausreden.",
      "Niemand fertig. Wenigstens bleibt der Waschkorb leer.",
      "Heute wird vor allem die Kunst des Nichtstuns optimiert.",
      "Niemand fertig. Aber hey, der Tag ist ja schon anstrengend genug.",
      "Die Muskeln schlafen, das Gewissen auch.",
      "Niemand fertig. Dafür ist der „Vielleicht morgen“-Muskel sehr stark.",
      "Das einzige was hier brennt, sind Ausreden.",
      "Niemand fertig. Aber die Fähigkeit, sich rauszureden, ist auf Olympianiveau.",
      "So viel Potenzial, so wenig Umsetzung.",
      "Niemand fertig. Vielleicht hilft morgen ein Wunder. Oder Kaffee.",
      "Heute ist wohl Ruhetag. Für alle. Ohne Grund.",
      "Niemand fertig. Aber der Gedanke daran war sicher schon anstrengend.",
      "Der Trainingsplan weint leise in der Ecke.",
      "Niemand fertig. Aber die Serienliste ist sicher gut abgearbeitet.",
      "Hier wird mehr über Sport geredet als gemacht.",
      "Niemand fertig. Aber immerhin konsequent inkonsequent.",
      "Das Einzige was heute hoch- und runtergeht, ist die Laune.",
      "Niemand fertig. Vielleicht war das hier nur ein Performance-Test für Ausreden.",
      "Heute trainieren nur die Scroll-Finger.",
      "Niemand fertig. Aber die Hoffnung, irgendwann anzufangen, lebt."
    ];

    const maleDone = [
      "Frau ist fertig, Mann sucht noch nach der perfekten Ausrede.",
      "Frau liefert, Mann liefert Argumente.",
      "Frau schwitzt, Mann sitzt.",
      "Frau top, Mann stopp.",
      "Frau stark, Mann snackt.",
      "Frau durch, Mann fast – aber nur mit den Nerven.",
      "Frau macht Wiederholungen, Mann macht Pausen.",
      "Frau fertig, Mann studiert noch YouTube-Tutorials.",
      "Frau rockt, Mann lockt … die Couch.",
      "Frau im Trainingsmodus, Mann im Schonmodus.",
      "Frau ackert, Mann analysiert.",
      "Frau durch, Mann diskutiert mit seinem Schweinehund.",
      "Frau kämpft, Mann denkt intensiv über Sport nach.",
      "Frau macht Gains, Mann macht Geräusche.",
      "Frau fertig, Mann in schwerer Verhandlung mit der Schwerkraft.",
      "Frau liefert ab, Mann liefert nach: irgendwann.",
      "Frau stabil, Mann fragil.",
      "Frau motiviert, Mann verwirrt.",
      "Frau finish, Mann fängt gleich an. Ehrlich.",
      "Frau erledigt, Mann erledigt – aber vom Zuschauen.",
      "Frau hat’s hinter sich, Mann sucht noch den Startknopf.",
      "Frau im Ziel, Mann noch in der Planungsphase.",
      "Frau fertig, Mann versucht gerade, den inneren Schweinehund zu duzen.",
      "Frau arbeitet, Mann wartet.",
      "Frau stark, Mann im Energiesparmodus.",
      "Frau hat geliefert, Mann hofft auf Lieferservice.",
      "Frau ist durch, Mann nur mit den Ausreden.",
      "Frau hat trainiert, Mann hat gestaunt – im Sitzen.",
      "Frau macht Fortschritte, Mann macht Geräusche beim Aufstehen.",
      "Frau durchgezogen, Mann durchgescrollt.",
      "Frau erledigt ihr Set, Mann erledigt seine Chips.",
      "Frau durch, Mann beschäftigt – mit Nichtstun.",
      "Frau trainiert, Mann probt sein Leidensgesicht.",
      "Frau powert, Mann pausiert.",
      "Frau stark, Mann argumentiert.",
      "Frau auf Kurs, Mann auf Couch.",
      "Frau voll im Modus, Mann voll im Sofa.",
      "Frau fertig, Mann verhandelt mit dem inneren Schweinehund.",
      "Frau glänzt mit Schweiß, Mann mit Ausflüchten.",
      "Frau im Beast-Mode, Mann im Sleep-Mode.",
      "Frau im Training, Mann im Observation-Mode.",
      "Frau macht Wiederholungen, Mann Wiederholungsfehler.",
      "Frau produktiv, Mann kreativ im Ausredenfinden.",
      "Frau drückt, Mann drückt sich.",
      "Frau fit, Mann sitzt.",
      "Frau liefert Leistung, Mann liefert Kommentare.",
      "Frau war fleißig, Mann war dabei – emotional.",
      "Frau ist on fire, Mann ist offline.",
      "Frau hat Tempo, Mann hat Tempo – beim Essen.",
      "Frau im Fokus, Mann im Hintergrundrauschen.",
      "Frau gewinnt, Mann erklärt, warum heute ein schlechter Tag zum Trainieren ist."
    ];

    const femaleDone = [
      "Mann ist fertig, Frau justiert noch die Motivation.",
      "Mann liefert, Frau liefert Kaffee.",
      "Mann schwitzt, Frau sitzt.",
      "Mann top, Frau stopp.",
      "Mann stark, Frau plant.",
      "Mann durch, Frau noch im Ladebildschirm.",
      "Mann macht Reps, Frau macht Pläne.",
      "Mann fertig, Frau spricht mit ihrem inneren Schweinehund.",
      "Mann trainiert, Frau moderiert.",
      "Mann in Bewegung, Frau in Beratung.",
      "Mann ackert, Frau sortiert Ausreden.",
      "Mann fertig, Frau studiert noch die Sterne.",
      "Mann liefert, Frau überlegt, ob heute überhaupt existiert.",
      "Mann kämpft, Frau kommentiert.",
      "Mann done, Frau don’t – noch.",
      "Mann stark, Frau strategisch passiv.",
      "Mann fertig, Frau in tiefem Gespräch mit der Couch.",
      "Mann gewinnt, Frau taktiert.",
      "Mann ready, Frau maybe.",
      "Mann rennt, Frau denkt.",
      "Mann hat geliefert, Frau hat geliefert – Argumente.",
      "Mann durchgeschwitzt, Frau durchorganisiert.",
      "Mann powert, Frau pauert… sich aus.",
      "Mann macht Sätze, Frau macht nur Ansätze.",
      "Mann im Training, Frau im Beratungsmodus mit sich selbst.",
      "Mann hat Muskelkater, Frau hat Gedankenkarussell.",
      "Mann ist fertig, Frau ist fast so weit – seit 20 Minuten.",
      "Mann im Sprint, Frau im Standby.",
      "Mann zieht durch, Frau zieht die Decke höher.",
      "Mann klopft sich den Schweiß ab, Frau klopft auf die Uhr.",
      "Mann trainiert, Frau erklärt Trainingsphilosophie.",
      "Mann stark, Frau skeptisch.",
      "Mann liefert, Frau analysiert, ob sich das überhaupt lohnt.",
      "Mann mit Häkchen, Frau mit Fragezeichen.",
      "Mann macht Wiederholungen, Frau wiederholt 'Morgen fang ich an'.",
      "Mann in Bewegung, Frau in Gedanken.",
      "Mann fertig, Frau erst bei 'gleich'.",
      "Mann schwitzt, Frau schützt… ihre Komfortzone.",
      "Mann trainiert ernsthaft, Frau trainiert Ausreden.",
      "Mann aufgeräumt, Frau überfordert – vom Gedanken an Sport.",
      "Mann fertig, Frau noch in der Evaluationsphase.",
      "Mann hat es durchgezogen, Frau zieht’s bis morgen.",
      "Mann aktiv, Frau kreativ – aber nicht sportlich.",
      "Mann fokussiert, Frau philosophiert.",
      "Mann war fleißig, Frau war beschäftigt – aber nicht mit Sport.",
      "Mann ist im Soll, Frau im 'Vielleicht später'.",
      "Mann im Trainingsmodus, Frau im 'Nur gucken'-Modus.",
      "Mann fertig, Frau verhandelt mit der Motivation.",
      "Mann macht Fortschritte, Frau macht To-Do-Listen.",
      "Mann gerockt, Frau geparkt."
    ];

    const praiseMale = [
      "Mann hat schon {{total}} Reps gesammelt. Knie sind beeindruckt, Ausreden beleidigt.",
      "Schon {{total}} Wiederholungen. Irgendwer nimmt das hier ernst.",
      "{{total}} Reps – nicht schlecht für jemanden, der angeblich müde ist.",
      "Mit {{total}} Reps ist der Mann offiziell nicht mehr im Anfänger-Modus.",
      "{{total}} Wiederholungen. Langsam wird das peinlich für den inneren Schweinehund.",
      "Mann bei {{total}} Reps. Das ist mehr als viele in einem ganzen Monat schaffen.",
      "{{total}} Reps – offenbar kann er doch mehr als jammern.",
      "Mit {{total}} Wiederholungen hat der Mann das Recht auf eine sehr große Mahlzeit.",
      "{{total}} Reps. Wahrscheinlich merkt der Körper das morgen.",
      "Mann auf {{total}} Reps. So langsam wird's ernst.",
      "{{total}} Mal hoch, runter, irgendwas. Hauptsache erledigt.",
      "Der Zähler steht bei {{total}}. Faul ist was anderes.",
      "{{total}} Wiederholungen – Respekt. Und ja, du musst weitermachen.",
      "Mann hat {{total}} Reps geballert. Die Couch vermisst ihn.",
      "{{total}} Reps. Nicht perfekt, aber eindeutig nicht faul.",
      "Mit {{total}} Wiederholungen wirkt die 'Ich kann nicht mehr'-Nummer eher süß.",
      "{{total}} Reps – die Ausreden sollten langsam verstummen.",
      "Mann auf {{total}} Reps. Noch ein bisschen, dann wird’s richtig unangenehm.",
      "{{total}} Wiederholungen. Gut, jetzt darf er kurz jammern.",
      "{{total}} Reps – das ist schon fast ein erwachsenes Trainingsverhalten.",
      "{{total}} Reps sind ein sehr lautes 'Ich tu doch was'.",
      "Mit {{total}} Wiederholungen hat er mehr getan als die meisten, die nur posten.",
      "Bei {{total}} Reps darf man sich kurz wichtig fühlen.",
      "Seine {{total}} Reps sind die natürliche Feindin der Ausreden.",
      "{{total}} Wiederholungen – offenbar meint er es doch ernst.",
      "Wenn jemand fragt: '{{total}} Reps.' Antwort reicht.",
      "Mit {{total}} Reps ist der Mann offiziell im 'Kein reiner Anfänger'-Status.",
      "Diese {{total}} Reps sind gebuchter Fortschritt, kein Wunschdenken.",
      "{{total}} Wiederholungen. Das ist mehr als nur Anlauf nehmen.",
      "Er hat {{total}} Reps erledigt. Das ist jetzt Aktenlage.",
      "{{total}} Reps – der statistische Beweis, dass er nicht komplett faul ist.",
      "Mit {{total}} Wiederholungen löscht man langsam den 'Couch-Potato'-Stempel.",
      "{{total}} Reps – genug, dass Jammern jetzt unglaubwürdig wirkt.",
      "Seine {{total}} Reps sind eine klare Kriegserklärung an den Schweinehund.",
      "{{total}} Wiederholungen. Der Muskelkater schreibt schon eine Grußkarte.",
      "Mit {{total}} Reps ist er in der Zone, wo Fortschritt echt sichtbar wird.",
      "{{total}} Reps – das ist mehr als ein guter Vorsatz.",
      "Diese {{total}} Wiederholungen können sich sehen lassen. Und man wird sie sehen.",
      "{{total}} Reps. Wer so weiter macht, muss neue Ausreden erfinden.",
      "Mit {{total}} Wiederholungen darf er sich offiziell 'drangeblieben' nennen.",
      "{{total}} Reps – ziemlich solide für jemanden mit funktionierender Sofa-Ecke.",
      "Seine {{total}} Wiederholungen sind das Gegenteil von 'Ich hatte keine Zeit'.",
      "Mit {{total}} Reps zeigt er, dass er nicht nur über Motivation redet.",
      "{{total}} Wiederholungen. Das ist kein Zufall mehr, das ist Absicht.",
      "Mann steht bei {{total}} Reps. Der Körper hat die Nachricht verstanden.",
      "Mit {{total}} Reps wird aus 'vielleicht' langsam 'natürlich'.",
      "{{total}} Wiederholungen. Der Fortschritt ist offiziell angemeldet.",
      "Diese {{total}} Reps sind der Grund, warum die Couch sich ersetzt fühlt.",
      "Mit {{total}} Reps ist er näher am Ziel als an der Ausrede.",
      "{{total}} Wiederholungen. Es wird schwerer, sich kleinzureden.",
      "Seine {{total}} Reps sagen ganz leise: 'Weiter so.'"
    ];

    const praiseFemale = [
      "Frau hat schon {{total}} Reps. Die Motivation gewinnt eindeutig.",
      "{{total}} Wiederholungen – und trotzdem funktionstüchtig. Beeindruckend.",
      "Mit {{total}} Reps ist sie offiziell die zuverlässigere Hälfte.",
      "{{total}} Reps. Die Couch ist beleidigt, aber stolz.",
      "Frau bei {{total}} Wiederholungen. Da kann man 'faul' offiziell streichen.",
      "{{total}} Reps – das ist keine Spielerei mehr.",
      "Mit {{total}} Wiederholungen hat sie dem inneren Schweinehund die Stirn geboten.",
      "{{total}} Reps. Das Ego darf zurecht größer werden.",
      "Frau steht bei {{total}} Reps. Stabiler als mancher Trainingsplan.",
      "{{total}} Wiederholungen – das ist mehr Einsatz als viele in einer Woche schaffen.",
      "Bei {{total}} Reps darf man leise an Muskelkater denken.",
      "{{total}} Reps: Disziplinstufe 'Beeindruckend'.",
      "Frau rockt {{total}} Wiederholungen. Der Rest der Welt scrollt.",
      "{{total}} Reps. Wenn das so weitergeht, braucht sie bald neue Ausreden.",
      "Mit {{total}} Wiederholungen ist sie weit jenseits von 'Ich fang morgen an'.",
      "{{total}} Reps – das ist nicht mehr Hobby, das ist Statement.",
      "Frau bei {{total}} Wiederholungen. Der Schweinehund weint leise.",
      "{{total}} Reps. Wenn er mithalten will, muss er sich beeilen.",
      "Mit {{total}} Wiederholungen ist sie offiziell im 'Kein-Witz-mehr'-Bereich.",
      "{{total}} Reps. Dazu passt: weniger reden, mehr staunen.",
      "Ihre {{total}} Reps sind eine schallende Ohrfeige für Bequemlichkeit.",
      "Mit {{total}} Wiederholungen hat sie sich jede Pause verdient.",
      "{{total}} Reps – das ist Material für eine ordentliche Portion Stolz.",
      "Diese {{total}} Wiederholungen sprechen deutlich: Sie zieht durch.",
      "Mit {{total}} Reps ist sie weit vor allen, die nur zuschauen.",
      "{{total}} Wiederholungen. Ihr Schweinehund schreibt gerade Kündigung.",
      "Frau steht bei {{total}} Reps. Das ist nicht Zufall, das ist Absicht.",
      "{{total}} Reps – das ist 'Ich mein’s ernst' in Zahlen.",
      "Diese {{total}} Wiederholungen sind die beste Antwort auf 'Ich kann das nicht'.",
      "Mit {{total}} Reps ist sie auf dem Weg, ihr zukünftiges Ich stolz zu machen.",
      "{{total}} Wiederholungen. Wenn Motivation eine Währung wäre, wäre sie reich.",
      "Ihre {{total}} Reps sind ein Schlag ins Gesicht der Aufschieberitis.",
      "Mit {{total}} Reps beweist sie, dass Konsequenz sexy ist.",
      "{{total}} Wiederholungen – das ist kein Versuch mehr, das ist Routine.",
      "Frau auf {{total}} Reps. Das ist mehr als ein guter Vorsatz.",
      "Mit {{total}} Wiederholungen hat sie schon mehr getan als viele in einem Monat.",
      "Diese {{total}} Reps sind ein sehr deutlicher Fortschrittsmarker.",
      "{{total}} Wiederholungen. Und wahrscheinlich nicht mal ihr Limit.",
      "Mit {{total}} Reps ist sie nicht mehr 'am Anfang', sondern mittendrin.",
      "{{total}} Reps – und die Skala Richtung 'stark' verschiebt sich weiter.",
      "Ihre {{total}} Wiederholungen sind das laute Gegenteil von 'Ich bin halt so'.",
      "Mit {{total}} Reps zeigt sie, dass Disziplin kein Mythos ist.",
      "{{total}} Wiederholungen. Das ist inzwischen eine Geschichte, kein Zufall.",
      "Frau bei {{total}} Reps. Da darf man schon mal anerkennend nicken.",
      "Mit {{total}} Wiederholungen hat sie bewiesen, dass Willenskraft real ist.",
      "{{total}} Reps – das ist die Art von Statistik, die motiviert.",
      "Ihre {{total}} Reps sind ein stiller, aber sehr deutlicher Flex.",
      "Mit {{total}} Wiederholungen ist sie meilenweit weg von 'Vielleicht irgendwann'.",
      "{{total}} Reps. Man könnte fast meinen, sie meint es ernst. Weil sie es tut."
    ];

    // ================== LOGIK ==================

    let idxNobody = 0, idxMale = 0, idxFem = 0, idxPM = 0, idxPF = 0;

    function rotate(arr, key){
      if (!Array.isArray(arr) || arr.length === 0) return "";
      const i = window[key] % arr.length;
      window[key] = (window[key] + 1) % arr.length;
      return arr[i];
    }

    function renderOverall(s){
      const box = document.getElementById("overallBox");
      box.innerHTML = "";

      ["male","female"].forEach(p=>{
        const pname = p==="male" ? "Mann" : "Frau";
        const div = document.createElement("div");
        div.className = "overall-person";
        div.textContent = pname;
        box.appendChild(div);

        let total = 0;
        ["squats","situps","pushups"].forEach(ex=>{
          const row = document.createElement("div");
          row.className = "overall-row";
          const label = ex==="squats" ? "Squats" : ex==="situps" ? "Situps" : "Push Ups";
          const val = (s.overall && s.overall[p] && s.overall[p][ex]) || 0;
          total += val;
          row.innerHTML = `<span>${label}</span><span>${val} reps total</span>`;
          box.appendChild(row);
        });

        const praise = document.createElement("div");
        praise.className = "text-small";
        if (total === 0){
          praise.textContent = "Noch keine Reps. Aktuell gewinnt die Bequemlichkeit.";
        } else {
          let msg = p==="male" ? rotate(praiseMale,"idxPM") : rotate(praiseFemale,"idxPF");
          praise.textContent = msg.replace("{{total}}", total);
        }
        box.appendChild(praise);
      });
    }

    function renderPerson(containerId, key, s){
      const cont = document.getElementById(containerId);
      cont.innerHTML = "";

      const reps = (s.reps && s.reps[key]) || {squats:0,situps:0,pushups:0};
      const day = s.day;
      const skippedToday = (s.skip && s.skip[key] || []).indexOf(day) !== -1;
      const injuredToday = (s.injured && s.injured[key] || []).indexOf(day) !== -1;
      const cantToday = (s.cant && s.cant[key] || []).indexOf(day) !== -1;
      const canClick = (whoAmI === key);

      ["squats","situps","pushups"].forEach(ex=>{
        const row = document.createElement("div");
        let cls = "exercise";
        if (s[key] && s[key][ex]) cls += " done";
        if (injuredToday) cls += " injured";
        row.className = cls;

        const label = ex==="squats" ? "Squats" : ex==="situps" ? "Situps" : "Push Ups";
        const icon = injuredToday ? "✗ " : "";
        const val = reps[ex] || 0;

        row.innerHTML = `<span>${label}</span><strong>${icon}${val}x</strong>`;

        if (canClick){
          row.addEventListener("click", async ()=>{
            await fetch("/api/toggle",{
              method:"POST",
              headers:{"Content-Type":"application/json"},
              body:JSON.stringify({person:key,exercise:ex})
            });
            loadAndRender();
          });
        }

        cont.appendChild(row);
      });

      // Skip-Day sichtbar, wenn ich selbst ODER heute geskippt
      if (canClick || skippedToday){
        const skip = document.createElement("div");
        skip.className = "skip-btn" + (canClick ? "" : " readonly");
        skip.textContent = "Skip-Day nutzen";
        if (canClick){
          skip.addEventListener("click", async ()=>{
            const r = await fetch("/api/skip",{
              method:"POST",
              headers:{"Content-Type":"application/json"},
              body:JSON.stringify({person:key})
            });
            const data = await r.json();
            if (data.warning) alert(data.warning);
            loadAndRender();
          });
        }
        cont.appendChild(skip);
      }

      // Verletz/Krank sichtbar, wenn ich selbst ODER heute verletzt
      if (canClick || injuredToday){
        const inj = document.createElement("div");
        inj.className = "injured-btn" + (canClick ? "" : " readonly");
        inj.textContent = "Verletzt / krank (heute)";
        if (canClick){
          inj.addEventListener("click", async ()=>{
            await fetch("/api/injured",{
              method:"POST",
              headers:{"Content-Type":"application/json"},
              body:JSON.stringify({person:key})
            });
            loadAndRender();
          });
        }
        cont.appendChild(inj);
      }

      // "Ich kann nicht mehr" sichtbar, wenn ich selbst ODER heute benutzt
      if (canClick || cantToday){
        const cant = document.createElement("div");
        cant.className = "cant-btn" + (canClick ? "" : " readonly");
        cant.textContent = "Ich kann nicht mehr";
        if (canClick){
          cant.addEventListener("click", async ()=>{
            const pw = prompt("Passwort eingeben:");
            if (!pw) return;
            const r = await fetch("/api/reps_reduce",{
              method:"POST",
              headers:{"Content-Type":"application/json"},
              body:JSON.stringify({person:key,password:pw})
            });
            if (!r.ok){
              alert("Falsches Passwort. Nett versucht.");
              return;
            }
            loadAndRender();
          });
        }
        cont.appendChild(cant);
      }
    }

    function updateStatus(s){
      const mDone = s.male && Object.values(s.male).every(Boolean);
      const fDone = s.female && Object.values(s.female).every(Boolean);
      const out = document.getElementById("overallStatus");

      if (mDone && fDone){
        out.innerHTML = "<span class='done'>Beide fertig. So sieht Disziplin aus.</span>";
      } else if (mDone && !fDone){
        out.innerHTML = `<span class='wait'>${rotate(femaleDone,"idxFem")}</span>`;
      } else if (!mDone && fDone){
        out.innerHTML = `<span class='wait'>${rotate(maleDone,"idxMale")}</span>`;
      } else {
        out.innerHTML = `<span class='wait'>${rotate(nobody,"idxNobody")}</span>`;
      }
    }

    async function loadAndRender(){
      try{
        const s = await fetchState();
        document.getElementById("day").textContent = s.day;
        document.getElementById("date").textContent = formatDate(s.day);

        renderOverall(s);
        renderPerson("maleExercises","male",s);
        renderPerson("femaleExercises","female",s);

        const mDone = s.male && Object.values(s.male).every(Boolean);
        const fDone = s.female && Object.values(s.female).every(Boolean);
        const btn = document.getElementById("nextDayBtn");
        if (mDone && fDone) btn.classList.remove("disabled");
        else btn.classList.add("disabled");

        updateStatus(s);
      } catch(e){
        console.error("Fehler in loadAndRender:", e);
      }
    }

    document.getElementById("nextDayBtn").addEventListener("click", async ()=>{
      const btn = document.getElementById("nextDayBtn");
      if (btn.classList.contains("disabled")) return;
      await fetch("/api/next_day",{method:"POST"});
      loadAndRender();
    });

    loadAndRender();
    setInterval(loadAndRender,5000);
    document.addEventListener("visibilitychange", ()=>{
      if (!document.hidden) loadAndRender();
    });
  </script>
</body>
</html>
